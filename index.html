<!DOCTYPE html>
<html lang="en">
<head>
    <!-- meta data -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The Middlesex School - After school classes website offers various lessons that students or parents on behalf of their children can choose from, to gain help in any subject.">
    <meta name="keywords" content="After School Classes, Help Classes, The Middlesex School">
    <meta name="author" content="Muhammad Rushaan Abbas">
    <!-- Site Icon & Title -->
    <title>The Middlesex School</title>
    <link rel="icon" type="image/png" href="assets/the-mdx-school.png">
    <!-- Links -->
    <link rel="stylesheet" href="css/basic.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/subject-section.css">
    <link rel="stylesheet" href="css/sort-section.css">
    <link rel="stylesheet" href="css/checkout.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <!-- Link for Subjects List file -->
    <script src="javascript/subjects.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <!-- Navigation Bar -->
            <section id="navigation-bar">
                <!-- School Logo -->
                <figure @mouseover="showSchool = true" @mouseleave="showSchool = false" v-on:click="showHomeSection()" class="nav-item">
                    <img v-bind:src="school.logo" class="nav-logo">
                </figure>
                <!-- School Info -->
                <p @mouseover="showInfo = true" @mouseleave="showInfo = false" class="nav-item">INFO</p>
                <!-- School Contact -->
                <p @mouseover="showContact = true" @mouseleave="showContact = false" class="nav-item">CONTACT</p>
                <!-- Search Box -->
                <div id="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" name="search" id="search-area">
                </div>
                <!-- Sort Button -->
                <button v-on:click="showSortSection()" class="nav-item nav-button">SORT</button>
                <!-- Checkout Button -->
                <button v-on:click="showCheckoutSection()" class="nav-item nav-button">CHECKOUT&nbsp;<i class="fa-solid fa-cart-shopping"></i>&nbsp;<div id="cart-counter">{{cartItemCount}}</div></button>
            </section>
            <!-- Drop down pop ups -->
            <div @mouseover="showSchool = true" @mouseleave="showSchool = false" id="school-info" v-show="showSchool" class="info-box">
                <figure class="nav-item">
                    <img v-bind:src="school.logo" style="width: 50px;">
                </figure>
                <h1>{{school.sitename}}</h1><h2>by Rushaan</h2>
            </div>
            <div @mouseover="showInfo = true" @mouseleave="showInfo = false" id="information" v-show="showInfo" class="info-box">
                <p>This web app allows students and</p><br><p>parents to explore and purchase after-</p><br><p>school classes and activities. Users can</p><br><p>browse lessons by subject, location,</p><br><p>price, and availability. The app offers an</p><br><p>intuitive shopping cart and checkout</p><br><p>experience for easy enrollment.</p>
            </div>
            <div @mouseover="showContact = true" @mouseleave="showContact = false" id="contact-info" v-show="showContact" class="info-box">
                <p>Our Hotline is <a href="tel:+123456789">+1 234 56789</a>,</p><br><p>For SMS <a href="sms:123">"123"</a>,</p><br><p>Or Email Us at <a href="mailto:someone@example.com">someone@example.com</a></p>
            </div>
        </header>
        <main>
            <!-- Show the home contents containing sort & subjects sections -->
            <transition name="fade" mode="out-in">
            <div v-if="!showCheckout" key="home">
                <!-- Sort Section -->
                <transition name="slide">
                <section id="sort-section" v-if="showSort" key="sort">
                    <h3><i class="fas fa-filter"></i> Sort</h3>
                </section>
                </transition>
                <!-- Subjects Section -->
                <section id="subject-section">
                    <!-- Subject Box -->
                    <div v-for="subject in subjects" :key="subject.id" class="subject-card">
                        <!-- Subject Icon -->
                        <figure>
                            <img v-bind:src="subject.img" class="subject-img">
                        </figure>
                        <h2 class="subject-item">{{ subject.title }}</h2>
                        <p class="subject-item subject-location">{{ subject.location }}</p>
                        <!-- Subject availablilty -->
                        <p v-if="subject.availability > 1" class="subject-item subject-avail">{{ subject.availability }} seats available</p>
                        <!-- Else if only 1 available seat -->
                        <p v-else-if="subject.availability == 1" class="subject-item subject-avail">{{ subject.availability }} seat available</p>
                        <!-- Else no seats available -->
                        <p v-else class="subject-item subject-avail">No seats available</p>
                        <p class="subject-item subject-price">${{ subject.price }}</p>
                        <button v-on:click="addToCart(subject)" v-if="subject.availability > 0" class="add-button">ADD TO CART</button>
                        <button disabled v-else class="add-button">NO SEATS AVAILABLE</button>
                    </div>
                </section>
            </div>
            <!-- Else show the checkout contents -->
            <div v-else key="checkout">
                <h2 class="title">Your Cart <i class="fa-solid fa-cart-shopping"></i></h2>
            </div>
            </transition>
        </main>
    </div>
    <script type="text/javascript">
        let app = new Vue({
            el: '#app',
            data: {
                school: {
                    sitename: 'The Middlesex School',
                    logo: 'assets/the-mdx-school.png'
                },
                showSchool: false,
                showInfo: false,
                showContact: false,
                showSort: false,
                showCheckout: false,
                currentView: 'home',
                // External subjects list is now called which contains all the subjects details
                subjects: subjectList,
                cart: []
            },
            methods: {
                showHomeSection: function() {
                    this.showCheckout = false;
                    this.showSort = false;
                },
                showSortSection: function() {
                    this.showSort = !this.showSort;
                    this.showCheckout = false;
                },
                showCheckoutSection: function() {
                    this.showCheckout = !this.showCheckout;
                    this.showSort = false;
                },
                addToCart: function(subject) {
                    if (subject.availability > 0) {
                        // Check if the subject is already in the cart
                        const cartItem = this.cart.find(id => id === subject.id);
                        
                        if (cartItem) {
                            // If the subject is already in the cart, increment orderedQuantity
                            const existingsubject = this.subjects.find(p => p.id === subject.id);
                            existingsubject.orderedQuantity++;
                        } else {
                            // If it's a new subject, add to cart and increment orderedQuantity
                            this.cart.push(subject.id);
                            subject.orderedQuantity++;
                        }

                        // Decrease availability in both cases
                        subject.availability--;
                    }
                },
            },
            computed: {
                cartItemCount: function() {
                    // Sum the orderedQuantity for each product in the cart
                    return this.cart.reduce((total, id) => {
                        const subject = this.subjects.find(s => s.id === id);
                        return total + (subject ? subject.orderedQuantity : 0);
                    }, 0) || "";
                },
            }
        })
    </script>
</body>
</html>
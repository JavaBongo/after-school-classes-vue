<!DOCTYPE html>
<html lang="en">
<head>
    <!-- meta data -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The Middlesex School - After school classes website offers various lessons that students or parents on behalf of their children can choose from, to gain help in any subject.">
    <meta name="keywords" content="After School Classes, Help Classes, The Middlesex School">
    <meta name="author" content="Muhammad Rushaan Abbas">
    <!-- Site Icon & Title -->
    <title>The Middlesex School</title>
    <link rel="icon" type="image/png" href="assets/the-mdx-school.png">
    <!-- Links -->
    <link rel="stylesheet" href="css/basic.css">
    <link rel="stylesheet" href="css/navigation.css">
    <link rel="stylesheet" href="css/subject-section.css">
    <link rel="stylesheet" href="css/sort-section.css">
    <link rel="stylesheet" href="css/checkout.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <!-- Link for Subjects List file -->
    <script src="javascript/subjects.js"></script>
</head>
<body>
    <div id="app">
        <header>
            <!-- Navigation Bar -->
            <section id="navigation-bar">
                <!-- School Logo -->
                <figure @mouseover="showSchool = true" @mouseleave="showSchool = false" v-on:click="showHomeSection()" class="nav-item">
                    <img v-bind:src="school.logo" class="nav-logo">
                </figure>
                <!-- School Info -->
                <p @mouseover="showInfo = true" @mouseleave="showInfo = false" class="nav-item">INFO</p>
                <!-- School Contact -->
                <p @mouseover="showContact = true" @mouseleave="showContact = false" class="nav-item">CONTACT</p>
                <!-- Search Box -->
                <div id="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" name="search" id="search-area">
                </div>
                <!-- Sort Button -->
                <button v-on:click="showSortSection()" class="nav-item nav-button">SORT</button>
                <!-- Checkout Button -->
                <button v-on:click="showCheckoutSection()" class="nav-item nav-button">CHECKOUT&nbsp;<i class="fa-solid fa-cart-shopping"></i>&nbsp;<div id="cart-counter">{{cartItemCount}}</div></button>
            </section>
            <!-- Drop down pop ups -->
            <div @mouseover="showSchool = true" @mouseleave="showSchool = false" id="school-info" v-show="showSchool" class="info-box">
                <figure class="nav-item">
                    <img v-bind:src="school.logo" style="width: 50px;">
                </figure>
                <h1>{{school.sitename}}</h1><h2>by Rushaan</h2>
            </div>
            <div @mouseover="showInfo = true" @mouseleave="showInfo = false" id="information" v-show="showInfo" class="info-box">
                <p>This web app allows students and</p><br><p>parents to explore and purchase after-</p><br><p>school classes and activities. Users can</p><br><p>browse lessons by subject, location,</p><br><p>price, and availability. The app offers an</p><br><p>intuitive shopping cart and checkout</p><br><p>experience for easy enrollment.</p>
            </div>
            <div @mouseover="showContact = true" @mouseleave="showContact = false" id="contact-info" v-show="showContact" class="info-box">
                <p>Our Hotline is <a href="tel:+123456789">+1 234 56789</a>,</p><br><p>For SMS <a href="sms:123">"123"</a>,</p><br><p>Or Email Us at <a href="mailto:someone@example.com">someone@example.com</a></p>
            </div>
        </header>
        <main>
            <!-- Show the home contents containing sort & subjects sections -->
            <transition name="fade" mode="out-in">
            <div v-if="!showCheckout" key="home">
                <!-- Sort Section -->
                <transition name="slide">
                <section id="sort-section" v-if="showSort" key="sort">
                    <div class="filter-section">
                        <h3><i class="fas fa-filter"></i> Sort</h3>
                        <!-- Title - Sort Tag -->
                        <button 
                            v-on:click="sort.tag = 'title'"
                            :class="{'sort-tag': true, 'active': sort.tag === 'title'}">
                            Subject
                        </button>
                        <!-- Location - Sort Tag -->
                        <button 
                            v-on:click="sort.tag = 'location'" 
                            :class="{'sort-tag': true, 'active': sort.tag === 'location'}">
                            Location
                        </button>
                        <!-- Availability - Sort Tag -->
                        <button 
                            v-on:click="sort.tag = 'availability'" 
                            :class="{'sort-tag': true, 'active': sort.tag === 'availability'}">
                            Availability
                        </button>
                        <!-- Price - Sort Tag -->
                        <button 
                            v-on:click="sort.tag = 'price'" 
                            :class="{'sort-tag': true, 'active': sort.tag === 'price'}">
                            Price
                        </button>
                        <!-- Sort Direction Button if: Desc to Asc -->
                        <button v-if="sort.direction" v-on:click="applySort" class="sort-button"><i class="fa-solid fa-arrow-up-short-wide"></i></button>
                        <!-- Sort Direction Button else: Asc to Desc -->
                        <button v-else v-on:click="applySort" class="sort-button"><i class="fa-solid fa-arrow-down-wide-short"></i></button>
                    </div>
                </section>
                </transition>
                <!-- Subjects Section -->
                <section id="subject-section">
                    <!-- Subject Box -->
                    <div v-for="subject in sortedProducts" :key="subject.id" class="subject-card">
                        <!-- Subject Icon -->
                        <figure>
                            <img v-bind:src="subject.img" class="subject-img">
                        </figure>
                        <h2 class="subject-item">{{ subject.title }}</h2>
                        <p class="subject-item subject-location">{{ subject.location }}</p>
                        <!-- Subject availablilty -->
                        <p v-if="subject.availability > 1" class="subject-item subject-avail">{{ subject.availability }} seats available</p>
                        <!-- Else if only 1 available seat -->
                        <p v-else-if="subject.availability == 1" class="subject-item subject-avail">{{ subject.availability }} seat available</p>
                        <!-- Else no seats available -->
                        <p v-else class="subject-item subject-avail">No seats available</p>
                        <p class="subject-item subject-price">${{ subject.price }}</p>
                        <button v-on:click="addToCart(subject)" v-if="subject.availability > 0" class="add-button">ADD TO CART</button>
                        <button disabled v-else class="add-button">NO SEATS AVAILABLE</button>
                    </div>
                </section>
            </div>
            <!-- Else show the checkout contents -->
            <div v-else key="checkout">
                <!-- Cart Section -->
                <section id="cart-section">
                    <!-- Cart Section Title -->
                    <h2 class="title">Your Cart <i class="fa-solid fa-cart-shopping"></i></h2>
                    <!-- Cart Items Container -->
                    <div id="cart-items-container">
                        <!-- Cart Items: Looping all cart items to show cart products -->
                        <div v-for="item in cartItems" :key="item.id" class="cart-product">
                            <!-- Cart Product Icon -->
                            <figure class="cart-product-figure">
                                <img :src="item.img" class="cart-product-img" alt="Product image">
                            </figure>
                            <!-- Cart Product Information -->
                            <div class="cart-product-info">
                                <!-- Cart Product Title & Location -->
                                <h2 class="cart-product-title">{{ item.title }}</h2>
                                <p class="cart-product-location">{{ item.location }}</p>
                                <!-- Quantity Controls -->
                                 <div class="cart-product-subsection">
                                    <p class="qty">Qty: </p>
                                    <div class="cart-product-quantity">
                                        <!-- Quantity Subtract Button -->
                                        <button v-on:click="subtractFromCart(item)" class="quantity-button">-</button>
                                        <!-- Cart Product Quantity Counter -->
                                        <p class="cart-product-count">{{ item.orderedQuantity }}</p>
                                        <!-- Quantity Addition Button -->
                                        <button v-on:click="addToCart(item)" class="quantity-button">+</button>
                                    </div>
                                    <!-- Cart Product Price -->
                                    <p class="cart-product-rate">${{ item.price }}.00</p>
                                </div>
                                <!-- Remove Cart Product -->
                                <p v-on:click="removeFromCart(item)" class="remove">Remove {{ item.title }}</p>
                            </div>
                            <div>
                                <!-- Total Product Price = item price * item ordered quantity -->
                                <p class="cart-product-price">${{ item.price * item.orderedQuantity }}.00</p>
                            </div>
                        </div>
                    </div>
                    <!-- Price Overview Container -->
                    <div id="price-overview">
                        <h3 class="title">Price Overview</h3>
                        <hr class="po-line">
                        <span class="po-span"><p class="po-text">SUBTOTAL</p><p class="price-text">${{ cartSubtotal.toFixed(2) }}</p></span>
                        <span class="po-span"><p class="po-text">TAX</p><p class="price-text">$0.00</p></span>
                        <!-- Total cost of all cart products -->
                        <span class="po-span-2"><p class="po-text">TOTAL</p><p class="price-text">${{ cartSubtotal.toFixed(2)}}</p></span>
                        <!-- Proceed to Checkout Form Button -->
                        <a href="#checkout-form"><button id="ptcButton" disabled>PROCEED TO CHECKOUT</button></a>
                    </div>
                </section>
            </div>
            </transition>
        </main>
    </div>
    <script type="text/javascript">
        let app = new Vue({
            el: '#app',
            data: {
                school: {
                    sitename: 'The Middlesex School',
                    logo: 'assets/the-mdx-school.png'
                },
                showSchool: false,
                showInfo: false,
                showContact: false,
                showSort: false,
                showCheckout: false,
                currentView: 'home',
                // External subjects list is now called which contains all the subjects details
                subjects: subjectList,
                sort: {
                    tag: 'title',
                    direction: true
                },
                cart: []
            },
            methods: {
                showHomeSection: function() {
                    this.showCheckout = false;
                    this.showSort = false;
                },
                showSortSection: function() {
                    this.showSort = !this.showSort;
                    this.showCheckout = false;
                },
                showCheckoutSection: function() {
                    this.showCheckout = !this.showCheckout;
                    this.showSort = false;
                },
                addToCart: function(subject) {
                    if (subject.availability > 0) {
                        // Check if the subject is already in the cart
                        const cartItem = this.cart.find(id => id === subject.id);
                        
                        if (cartItem) {
                            // If the subject is already in the cart, increment orderedQuantity
                            const existingsubject = this.subjects.find(p => p.id === subject.id);
                            existingsubject.orderedQuantity++;
                        } else {
                            // If it's a new subject, add to cart and increment orderedQuantity
                            this.cart.push(subject.id);
                            subject.orderedQuantity++;
                        }

                        // Decrease availability in both cases
                        subject.availability--;
                    }
                },
                applySort: function() {
                    this.sort.direction = !this.sort.direction;
                },
                subtractFromCart: function(product) {
                    if (product.orderedQuantity > 0) {
                        product.orderedQuantity--;
                        product.availability++;
                        // If the orderedQuantity reaches zero, remove the product from the cart
                        if (product.orderedQuantity === 0) {
                            const index = this.cart.indexOf(product.id);
                            if (index !== -1) {
                                this.cart.splice(index, 1); // Remove the product from the cart
                            }
                        }
                        // Change back to product section if no items in the car
                        if(!this.cart.length) {
                            this.showForm = false;
                            this.showCheckout = false;
                            this.showSort = false
                        }
                    }
                },
                removeFromCart: function(product) {
                    const index = this.cart.indexOf(product.id);
                    if (index !== -1) {
                        // Restore the availability
                        product.availability += product.orderedQuantity;

                        // Reset orderedQuantity
                        product.orderedQuantity = 0;

                        // Remove the product from the cart
                        this.cart.splice(index, 1);

                        // Change back to product section if no items in the car
                        if(!this.cart.length) {
                            this.showForm = false;
                            this.showCheckout = false;
                            this.showSort = false
                        }
                    }
                },
            },
            computed: {
                cartItemCount: function() {
                    // Sum the orderedQuantity for each product in the cart
                    return this.cart.reduce((total, id) => {
                        const subject = this.subjects.find(s => s.id === id);
                        return total + (subject ? subject.orderedQuantity : 0);
                    }, 0) || "";
                },
                cartItems() {
                    // Map product IDs in the cart to their full product details
                    return this.cart.map(id => {
                        return this.subjects.find(subject => subject.id === id);
                    });
                },
                cartSubtotal() {
                    // Calculate the total price for all items in the cart
                    return this.cart.reduce((total, id) => {
                        const subject = this.subjects.find(s => s.id === id);
                        return total + (subject ? subject.price * subject.orderedQuantity : 0);
                    }, 0);
                },
                sortedProducts() {
                    let subjectsArray = this.subjects.slice(0);
                    const compare = (a, b) => {
                        let result = 0;

                        if (a[this.sort.tag] > b[this.sort.tag]) {
                            result = 1;
                        } else if (a[this.sort.tag] < b[this.sort.tag]) {
                            result = -1;
                        }

                        // Reverse the order if sort.direction is false
                        return this.sort.direction ? result : -result;
                    };

                    return subjectsArray.sort(compare);
                }
            }
        })
    </script>
</body>
</html>